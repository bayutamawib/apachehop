<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>pyspark</name>
    <name_sync_with_filename>Y</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <parameters>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2025/05/20 00:27:23.785</created_date>
    <modified_user>-</modified_user>
    <modified_date>2025/05/20 00:27:23.785</modified_date>
  </info>
  <notepads>
  </notepads>
  <order>
    <hop>
      <from>Execute SQL script</from>
      <to>Execute SQL script 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Execute SQL script 2</from>
      <to>Execute SQL script 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>PostgreSQL Bulk Loader</from>
      <to>Execute SQL script</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>PostgreSQL Bulk Loader 2</from>
      <to>Execute SQL script</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>stg.products.csv</from>
      <to>PostgreSQL Bulk Loader 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>stg.sales.csv</from>
      <to>PostgreSQL Bulk Loader</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Execute SQL script 3</from>
      <to>Run SSH commands</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Execute SQL script</name>
    <type>ExecSql</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <arguments>
      <argument>
        <name>salesid</name>
      </argument>
      <argument>
        <name>salespersonid</name>
      </argument>
      <argument>
        <name>customerid</name>
      </argument>
      <argument>
        <name>productid</name>
      </argument>
      <argument>
        <name>quantity</name>
      </argument>
      <argument>
        <name>discount</name>
      </argument>
      <argument>
        <name>totalprice</name>
      </argument>
      <argument>
        <name>salesdate</name>
      </argument>
      <argument>
        <name>transactionnumber</name>
      </argument>
      <argument>
        <name>ProductName</name>
      </argument>
      <argument>
        <name>Price</name>
      </argument>
      <argument>
        <name>CategoryID</name>
      </argument>
      <argument>
        <name>Class</name>
      </argument>
      <argument>
        <name>ModifyDate</name>
      </argument>
      <argument>
        <name>Resistant</name>
      </argument>
      <argument>
        <name>IsAllergic</name>
      </argument>
      <argument>
        <name>VitalityDays</name>
      </argument>
    </arguments>
    <connection>bayu_neondb</connection>
    <execute_each_row>N</execute_each_row>
    <quoteString>N</quoteString>
    <replace_variables>N</replace_variables>
    <set_params>N</set_params>
    <single_statement>Y</single_statement>
    <sql>insert into dm.dim_sales (productid, productname, categoryid, class, price)
select 
	ProductID,
	ProductName,
	CategoryID,
	Class,
	Price
from stg.products</sql>
    <attributes/>
    <GUI>
      <xloc>624</xloc>
      <yloc>208</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Execute SQL script 2</name>
    <type>ExecSql</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <arguments>
</arguments>
    <connection>bayu_neondb</connection>
    <execute_each_row>N</execute_each_row>
    <quoteString>N</quoteString>
    <replace_variables>N</replace_variables>
    <set_params>N</set_params>
    <single_statement>N</single_statement>
    <sql>with ad as(
select
	s.productid,
	avg(s.discount) as avgdiscount
from
	stg.sales s
group by s.productid
order by s.productid
)
update dm.dim_sales ds
set avgdiscount = ad.avgdiscount
from ad
where ds.productid = ad.productid;
	</sql>
    <attributes/>
    <GUI>
      <xloc>768</xloc>
      <yloc>208</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Execute SQL script 3</name>
    <type>ExecSql</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <arguments>
</arguments>
    <connection>bayu_neondb</connection>
    <execute_each_row>N</execute_each_row>
    <quoteString>N</quoteString>
    <replace_variables>N</replace_variables>
    <set_params>N</set_params>
    <single_statement>N</single_statement>
    <sql>with sq as(
select
	s.productid,
	sum(s.quantity) as quantity
from
	stg.sales s
group by s.productid
order by s.productid
)
update dm.dim_sales ds
set quantity = sq.quantity
from sq
where ds.productid = sq.productid;</sql>
    <attributes/>
    <GUI>
      <xloc>928</xloc>
      <yloc>208</yloc>
    </GUI>
  </transform>
  <transform>
    <name>PostgreSQL Bulk Loader</name>
    <type>PGBulkLoader</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>bayu_neondb</connection>
    <delimiter>;</delimiter>
    <enclosure>"</enclosure>
    <load_action>INSERT</load_action>
    <mapping>
      <date_mask/>
      <field_name>salesid</field_name>
      <stream_name>salesid</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>salespersonid</field_name>
      <stream_name>salespersonid</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>customerid</field_name>
      <stream_name>customerid</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>productid</field_name>
      <stream_name>productid</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>quantity</field_name>
      <stream_name>quantity</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>discount</field_name>
      <stream_name>discount</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>totalprice</field_name>
      <stream_name>totalprice</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>salesdate</field_name>
      <stream_name>salesdate</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>transactionnumber</field_name>
      <stream_name>transactionnumber</stream_name>
    </mapping>
    <schema>stg</schema>
    <stop_on_error>N</stop_on_error>
    <table>sales</table>
    <attributes/>
    <GUI>
      <xloc>448</xloc>
      <yloc>160</yloc>
    </GUI>
  </transform>
  <transform>
    <name>PostgreSQL Bulk Loader 2</name>
    <type>PGBulkLoader</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>bayu_neondb</connection>
    <delimiter>;</delimiter>
    <enclosure>"</enclosure>
    <load_action>INSERT</load_action>
    <mapping>
      <date_mask/>
      <field_name>ProductID</field_name>
      <stream_name>productid</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>ProductName</field_name>
      <stream_name>productname</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>Price</field_name>
      <stream_name>price</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>CategoryID</field_name>
      <stream_name>categoryid</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>Class</field_name>
      <stream_name>class</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>ModifyDate</field_name>
      <stream_name>modifydate</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>Resistant</field_name>
      <stream_name>resistant</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>IsAllergic</field_name>
      <stream_name>isallergic</stream_name>
    </mapping>
    <mapping>
      <date_mask/>
      <field_name>VitalityDays</field_name>
      <stream_name>vitalitydays</stream_name>
    </mapping>
    <schema>stg</schema>
    <stop_on_error>N</stop_on_error>
    <table>products</table>
    <attributes/>
    <GUI>
      <xloc>448</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>stg.products.csv</name>
    <type>CSVInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <filename>/Users/narendrabayutamaw/Documents/Apache Hop - Neo4J/20180508.products.csv</filename>
    <filename_field/>
    <rownum_field/>
    <include_filename>N</include_filename>
    <separator>;</separator>
    <enclosure>"</enclosure>
    <header>Y</header>
    <buffer_size>50000</buffer_size>
    <schemaDefinition/>
    <lazy_conversion>Y</lazy_conversion>
    <add_filename_result>N</add_filename_result>
    <parallel>N</parallel>
    <newline_possible>N</newline_possible>
    <encoding/>
    <fields>
      <field>
        <name>ProductID</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>ProductName</name>
        <type>String</type>
        <format/>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>33</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>Price</name>
        <type>Number</type>
        <format>#.#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>CategoryID</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>Class</name>
        <type>String</type>
        <format/>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>6</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>ModifyDate</name>
        <type>Date</type>
        <format>yyyy-MM-dd HH:mm:ss.SSS</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>Resistant</name>
        <type>String</type>
        <format/>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>7</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>IsAllergic</name>
        <type>String</type>
        <format/>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>5</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>VitalityDays</name>
        <type>String</type>
        <format/>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>4</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>288</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>stg.sales.csv</name>
    <type>CSVInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <filename>/Users/narendrabayutamaw/Documents/Apache Hop - Neo4J/20180508.sales.csv</filename>
    <filename_field/>
    <rownum_field/>
    <include_filename>N</include_filename>
    <separator>;</separator>
    <enclosure>"</enclosure>
    <header>Y</header>
    <buffer_size>50000</buffer_size>
    <schemaDefinition/>
    <lazy_conversion>Y</lazy_conversion>
    <add_filename_result>N</add_filename_result>
    <parallel>N</parallel>
    <newline_possible>N</newline_possible>
    <encoding/>
    <fields>
      <field>
        <name>salesid</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>salespersonid</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>customerid</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>productid</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>quantity</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>discount</name>
        <type>Number</type>
        <format>#.#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>totalprice</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>15</length>
        <precision>0</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>salesdate</name>
        <type>Integer</type>
        <format>#</format>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
      <field>
        <name>transactionnumber</name>
        <type>String</type>
        <format/>
        <currency>$</currency>
        <decimal>.</decimal>
        <group>,</group>
        <length>20</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>288</xloc>
      <yloc>160</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Run SSH commands</name>
    <type>SSH</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <command>/Users/narendrabayutamaw/anaconda3/bin/python "/Users/narendrabayutamaw/Documents/Apache Hop - Neo4J/totalsales-avg.py" </command>
    <commandfieldname/>
    <dynamicCommandField>N</dynamicCommandField>
    <keyFileName/>
    <passPhrase>Encrypted </passPhrase>
    <password>Encrypted 2be98afc86aa7a28ba710a565d6c1fb8d</password>
    <port>22</port>
    <proxyHost/>
    <proxyPassword>Encrypted </proxyPassword>
    <proxyPort/>
    <proxyUsername/>
    <serverName>139.194.212.141</serverName>
    <stdErrFieldName>stdErr</stdErrFieldName>
    <stdOutFieldName>stdOut</stdOutFieldName>
    <timeOut>0</timeOut>
    <usePrivateKey>N</usePrivateKey>
    <userName>narendrabayutamaw</userName>
    <attributes/>
    <GUI>
      <xloc>1088</xloc>
      <yloc>208</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes/>
</pipeline>
